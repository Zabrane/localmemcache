<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Localmemcache</title>
    <link type="text/css" rel="stylesheet" href="style.css" media="screen"/>
  </head>
  <body>  

<div id="content">
<h1>A persistent key-value database based on mmap()'ed shared memory</h1>

<p><b>Localmemcache</b> is a library for C and ruby that aims to provide
an interface similar to memcached but for accessing local data instead of
remote data.  It's based on <b>mmap()</b>'ed shared memory for maximum speed.
Since version 0.3.0 it supports persistence, also making it a fast
alternative to GDBM and Berkeley DB.

<h2>Key features as of 0.3.0 (2009-04-17)</h2>
<li><a href="#performance">blazingly fast</a></li>
<li>persistent</li>
<li>parallel writes are supported by default</li>
<li>uses transactions internally to avoid data corruption</li>
<li>lightweight: the core library is just about <b>1400</b> lines of <b>C</b> code</li>

<h2>Requirements</h2>
<li>a &gt;=64bit Unix</li>
<li>a file system that offers <a href="http://en.wikipedia.org/wiki/Sparse_file">sparse files</a></li>
Note for <b>OS X</b>: <b>OS X</b> disqualifies as <b>HFS+</b> doesn't
have sparse files and <b>sem_timedwait</b>() and <b>sem_getvalue</b>() aren't
supported as well.
Note for <b>FreeBSD</b>: It has been reported that Localmemcache
sometimes hangs there, it is not yet clear what the problem is.

<h2>Install</h2>

<p>The Ruby binding is available as a Ruby Gem. It can be installed by executing</p>

<pre><code>gem install localmemcache
</code></pre>


If you just want to use the <b>C API</b>, download the .tar.gz from <a href="http://rubyforge.org/frs/?group_id=7925">here</a>.

<h2>Using</h2>
<b>API</b>:&nbsp;<a href="http://github.com/sck/localmemcache/blob/e980ba949034a349dbf0e6f8f9ef77bbe3e3e314/src/localmemcache.h">C</a>|<a href="http://localmemcache.rubyforge.org/doc/">Ruby</a><br>
<p><pre><code>require 'localmemcache'
# 1. the memcached way
# $lm = LocalMemCache.new :namespace => :viewcounters
# 2. the GDBM way
$lm = LocalMemCache.new :filename => "./viewcounters.lmc"
$lm[:foo] = 1
$lm[:foo]
$lm.delete(:foo)
</code></pre> 
(C version of this example: <a href="http://github.com/sck/localmemcache/blob/e980ba949034a349dbf0e6f8f9ef77bbe3e3e314/example/hello.c">hello.c</a>)
</p>

<a name="performance" id="performance"></a>
<h2>Performance</h2>

<p>Here's a quick speed comparison, made on an 
<b>Intel(R) Xeon(R) CPU E5205 @ 1.86GHz</b>:</p>
Ruby benchmark pseudo code:
<pre><code>2_000_000.times {
  index = rand(10000).to_s
  $hash.set(index, index)
  $hash.get(index)
}
</code></pre>

<pre>
Tokyo Tyrant:          <b>298,226.197</b> ms
MemCache:              <b>253,326.122</b> ms
GDBM:                   <b>24,226.116</b> ms
Localmemcache 0.2.2:     <b>5,799.225</b> ms
Localmemcache 0.3.0:     <b>5,300.055</b> ms
Ruby Hash of Strings:    <b>4,963.313</b> ms
</pre>
(<a href="http://github.com/sck/localmemcache/tree/e980ba949034a349dbf0e6f8f9ef77bbe3e3e314/bench">Code of the benchmarks used</a>)

<p>

So, on my machine, using <b>Localmemcache</b> 0.3.0 to store key-value
data on disk is about <b>10</b>% slower than keeping them in memory in a
Ruby hash of strings.   Also keep in mind that of the above mentioned
software components <b>Tokyo Tyrant</b> is the only one that offers
persistence and parallel writes like <b>Localmemcache</b> does.

<h2>Source code</h2>

<p>The source code is hosted on <a href="http://github.com/sck/localmemcache/tree/master">github</a>. It
can be retrieved by executing</p>

<pre><code>git clone git://github.com/sck/localmemcache.git
</code></pre>

<h2>Tips for backups</h1>

Note that you cannot copy Localmemcache's .lmc files while other
processes are making changes to the data, this will likely result in a
corrupt backup.  So you need to make sure that none of your processes are
writing during the time you do an backup.  As for copying sparse files,
<b>cp</b> recognizes them automatically, with <b>tar</b> you need to use
the <b>-S</b> option.

<h2><a href="http://localmemcache.rubyforge.org/doc/classes/LocalMemCache.html">Read on / RDoc</a></h2>

<h2>License</h2>

<p>Copyright (c) 2009 Sven C. Koehler (schween at s n a f u dot de)<br>
Localmemcache is freely distributable under the terms of an 
<a href="http://github.com/sck/localmemcache/blob/af51a7d10e7162551e0cb1cf1b1635c1c76fe8d2/COPYING">MIT-style license</a>.
</p>

</div>

  </body>
</html>
