<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: LocalMemCache</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">LocalMemCache</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/localmemcache_rb.html">
                localmemcache.rb
                </a>
        <br />
                <a href="../files/rblocalmemcache_c.html">
                rblocalmemcache.c
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
<tt><a href="LocalMemCache.html">LocalMemCache</a></tt> provides for a
Hashtable of strings in shared memory (via a memory mapped file), which
thus can be shared between processes on a computer. Here is an example of
its usage:
</p>
<pre>
  $lm = LocalMemCache.new :namespace =&gt; &quot;viewcounters&quot;
  $lm[:foo] = 1
  $lm[:foo]          # -&gt; &quot;1&quot;
  $lm.delete(:foo)
</pre>
<p>
<tt><a href="LocalMemCache.html">LocalMemCache</a></tt> can also be used as
a persistent key value database, just use the :filename instead of the
:namespace parameter.
</p>
<pre>
  $lm = LocalMemCache.new :filename =&gt; &quot;my-database.lmc&quot;
  $lm[:foo] = 1
  $lm[:foo]          # -&gt; &quot;1&quot;
  $lm.delete(:foo)

 == Default sizes of memory pools

 The default size for memory pools is 1024 (MB). It cannot be changed later,
 so choose a size that will provide enough space for all your data.  You
 might consider setting this size to the maximum filesize of your
 filesystem.  Also note that while these memory pools may look large on your
 disk, they really aren't, because with sparse files only those parts of the
 file which contain non-null data actually use disk space.

 == Automatic recovery from crashes

 In case a process is terminated while accessing a memory pool, other
 processes will wait for the lock up to 2 seconds, and will then try to
 resume the aborted operation.  This can also be done explicitly by using
 LocalMemCache.check(options).

 == Clearing memory pools

 Removing memory pools can be done with LocalMemCache.drop(options).

 == Environment

 If you use the :namespace parameter, the .lmc file for your namespace will
 reside in /var/tmp/localmemcache.  This can be overriden by setting the
 LMC_NAMESPACES_ROOT_PATH variable in the environment.

 == Storing Ruby Objects

 If you want to store Ruby objects instead of just strings, consider
 using LocalMemCache::SharedObjectStorage.
</pre>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000005">[]</a>&nbsp;&nbsp;
      <a href="#M000009">[]=</a>&nbsp;&nbsp;
      <a href="#M000003">check</a>&nbsp;&nbsp;
      <a href="#M000008">clear</a>&nbsp;&nbsp;
      <a href="#M000013">close</a>&nbsp;&nbsp;
      <a href="#M000006">delete</a>&nbsp;&nbsp;
      <a href="#M000002">drop</a>&nbsp;&nbsp;
      <a href="#M000011">each_pair</a>&nbsp;&nbsp;
      <a href="#M000004">get</a>&nbsp;&nbsp;
      <a href="#M000010">keys</a>&nbsp;&nbsp;
      <a href="#M000001">new</a>&nbsp;&nbsp;
      <a href="#M000012">random_pair</a>&nbsp;&nbsp;
      <a href="#M000007">set</a>&nbsp;&nbsp;
      <a href="#M000014">size</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">

    <div id="class-list">
      <h3 class="section-bar">Classes and Modules</h3>

      Class <a href="LocalMemCache/ArgError.html" class="link">LocalMemCache::ArgError</a><br />
Class <a href="LocalMemCache/DBVersionNotSupported.html" class="link">LocalMemCache::DBVersionNotSupported</a><br />
Class <a href="LocalMemCache/InitError.html" class="link">LocalMemCache::InitError</a><br />
Class <a href="LocalMemCache/LocalMemCacheError.html" class="link">LocalMemCache::LocalMemCacheError</a><br />
Class <a href="LocalMemCache/LockError.html" class="link">LocalMemCache::LockError</a><br />
Class <a href="LocalMemCache/LockTimedOut.html" class="link">LocalMemCache::LockTimedOut</a><br />
Class <a href="LocalMemCache/MemoryPoolClosed.html" class="link">LocalMemCache::MemoryPoolClosed</a><br />
Class <a href="LocalMemCache/MemoryPoolFull.html" class="link">LocalMemCache::MemoryPoolFull</a><br />
Class <a href="LocalMemCache/OutOfMemoryError.html" class="link">LocalMemCache::OutOfMemoryError</a><br />
Class <a href="LocalMemCache/RecoveryFailed.html" class="link">LocalMemCache::RecoveryFailed</a><br />
Class <a href="LocalMemCache/SharedObjectStorage.html" class="link">LocalMemCache::SharedObjectStorage</a><br />
Class <a href="LocalMemCache/ShmError.html" class="link">LocalMemCache::ShmError</a><br />
Class <a href="LocalMemCache/ShmLockFailed.html" class="link">LocalMemCache::ShmLockFailed</a><br />
Class <a href="LocalMemCache/ShmUnlockFailed.html" class="link">LocalMemCache::ShmUnlockFailed</a><br />

    </div>




      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000003" class="method-detail">
        <a name="M000003"></a>

        <div class="method-heading">
          <a href="LocalMemCache.src/M000003.html" target="Code" class="method-signature"
            onclick="popupCode('LocalMemCache.src/M000003.html');return false;">
          <span class="method-name"> LocalMemCache.check(*args)<br />
</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Tries to repair a corrupt namespace. Usually one doesn&#8216;t call this
method directly, it&#8216;s invoked automatically when operations time out.
</p>
<p>
valid options are [:namespace] [:filename]
</p>
<p>
The memory pool must be specified by either setting the :filename or
:namespace option.
</p>
        </div>
      </div>

      <div id="method-M000002" class="method-detail">
        <a name="M000002"></a>

        <div class="method-heading">
          <a href="LocalMemCache.src/M000002.html" target="Code" class="method-signature"
            onclick="popupCode('LocalMemCache.src/M000002.html');return false;">
          <span class="method-name"> LocalMemCache.drop(*args)<br />
</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Deletes a memory pool. If the :force option is <a
href="LocalMemCache.html#M000007">set</a>, locked semaphores are removed as
well.
</p>
<p>
WARNING: Do only call this method with the :force option if you are sure
that you really want to remove this memory pool and no more processes are
still using it.
</p>
<p>
If you <a href="LocalMemCache.html#M000006">delete</a> a pool and other
processes still have handles open on it, the status of these handles
becomes undefined. There&#8216;s no way for a process to know when a handle
is not valid anymore, so only <a
href="LocalMemCache.html#M000006">delete</a> a memory pool if you are sure
that all handles are closed.
</p>
<p>
valid options for <a href="LocalMemCache.html#M000002">drop</a> are
[:namespace] [:filename] [:force]
</p>
<p>
The memory pool must be specified by either setting the :filename or
:namespace option. The default for :force is false.
</p>
        </div>
      </div>

      <div id="method-M000001" class="method-detail">
        <a name="M000001"></a>

        <div class="method-heading">
          <a href="LocalMemCache.src/M000001.html" target="Code" class="method-signature"
            onclick="popupCode('LocalMemCache.src/M000001.html');return false;">
          <span class="method-name">new</span><span class="method-args">(options)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Creates a <a href="LocalMemCache.html#M000001">new</a> handle for accessing
a shared memory region.
</p>
<p>
<a href="LocalMemCache.html#M000001">LocalMemCache.new</a>
:namespace=&gt;&quot;foo&quot;, :size_mb=&gt; 1
</p>
<p>
<a href="LocalMemCache.html#M000001">LocalMemCache.new</a>
:filename=&gt;&quot;./foo.lmc&quot;
</p>
<p>
You must supply at least a :namespace or :filename parameter The size_mb
defaults to 1024 (1 GB).
</p>
<p>
If you use the :namespace parameter, the .lmc file for your namespace will
reside in /var/tmp/localmemcache. This can be overriden by setting the
LMC_NAMESPACES_ROOT_PATH variable in the environment.
</p>
<p>
When you first call .<a href="LocalMemCache.html#M000001">new</a> for a
previously not existing memory pool, a sparse file will be created and
memory and disk space will be allocated to hold the empty hashtable (about
100K), so the size_mb refers only to the maximum <a
href="LocalMemCache.html#M000014">size</a> of the memory pool. .<a
href="LocalMemCache.html#M000001">new</a> for an already existing memory
pool will only map the already previously allocated RAM into the virtual
address space of your process.
</p>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000005" class="method-detail">
        <a name="M000005"></a>

        <div class="method-heading">
          <a href="LocalMemCache.src/M000005.html" target="Code" class="method-signature"
            onclick="popupCode('LocalMemCache.src/M000005.html');return false;">
          <span class="method-name">lmc.get(key)   &rarr;   string value or nil<br />
lmc[key]       &rarr;   string value or nil<br />
</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Retrieve string value from hashtable.
</p>
        </div>
      </div>

      <div id="method-M000009" class="method-detail">
        <a name="M000009"></a>

        <div class="method-heading">
          <a href="LocalMemCache.src/M000009.html" target="Code" class="method-signature"
            onclick="popupCode('LocalMemCache.src/M000009.html');return false;">
          <span class="method-name">lmc.set(key, value)   &rarr;   Qnil<br />
lmc[key]=value        &rarr;   Qnil<br />
</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Set value for key in hashtable. Value and key will be converted to string.
</p>
        </div>
      </div>

      <div id="method-M000008" class="method-detail">
        <a name="M000008"></a>

        <div class="method-heading">
          <a href="LocalMemCache.src/M000008.html" target="Code" class="method-signature"
            onclick="popupCode('LocalMemCache.src/M000008.html');return false;">
          <span class="method-name">lmc.clear &rarr; Qnil<br />
</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Clears content of hashtable.
</p>
        </div>
      </div>

      <div id="method-M000013" class="method-detail">
        <a name="M000013"></a>

        <div class="method-heading">
          <a href="LocalMemCache.src/M000013.html" target="Code" class="method-signature"
            onclick="popupCode('LocalMemCache.src/M000013.html');return false;">
          <span class="method-name">lmc.close()   &rarr;   Qnil<br />
</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Releases hashtable.
</p>
        </div>
      </div>

      <div id="method-M000006" class="method-detail">
        <a name="M000006"></a>

        <div class="method-heading">
          <a href="LocalMemCache.src/M000006.html" target="Code" class="method-signature"
            onclick="popupCode('LocalMemCache.src/M000006.html');return false;">
          <span class="method-name">lmc.delete(key)   &rarr;   Qnil<br />
</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Deletes key from hashtable. The key is converted to string.
</p>
        </div>
      </div>

      <div id="method-M000011" class="method-detail">
        <a name="M000011"></a>

        <div class="method-heading">
          <a href="LocalMemCache.src/M000011.html" target="Code" class="method-signature"
            onclick="popupCode('LocalMemCache.src/M000011.html');return false;">
          <span class="method-name">lmc.each_pair {|k, v|  block } &rarr; nil<br />
</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Iterates over hashtable.
</p>
        </div>
      </div>

      <div id="method-M000004" class="method-detail">
        <a name="M000004"></a>

        <div class="method-heading">
          <a href="LocalMemCache.src/M000004.html" target="Code" class="method-signature"
            onclick="popupCode('LocalMemCache.src/M000004.html');return false;">
          <span class="method-name">lmc.get(key)   &rarr;   string value or nil<br />
lmc[key]       &rarr;   string value or nil<br />
</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Retrieve string value from hashtable.
</p>
        </div>
      </div>

      <div id="method-M000010" class="method-detail">
        <a name="M000010"></a>

        <div class="method-heading">
          <a href="LocalMemCache.src/M000010.html" target="Code" class="method-signature"
            onclick="popupCode('LocalMemCache.src/M000010.html');return false;">
          <span class="method-name">lmc.keys()   &rarr;   array or nil<br />
</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns a list of <a href="LocalMemCache.html#M000010">keys</a>.
</p>
        </div>
      </div>

      <div id="method-M000012" class="method-detail">
        <a name="M000012"></a>

        <div class="method-heading">
          <a href="LocalMemCache.src/M000012.html" target="Code" class="method-signature"
            onclick="popupCode('LocalMemCache.src/M000012.html');return false;">
          <span class="method-name">lmc.random_pair()   &rarr;  [key, value] or nil<br />
</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Retrieves random pair from hashtable.
</p>
        </div>
      </div>

      <div id="method-M000007" class="method-detail">
        <a name="M000007"></a>

        <div class="method-heading">
          <a href="LocalMemCache.src/M000007.html" target="Code" class="method-signature"
            onclick="popupCode('LocalMemCache.src/M000007.html');return false;">
          <span class="method-name">lmc.set(key, value)   &rarr;   Qnil<br />
lmc[key]=value        &rarr;   Qnil<br />
</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Set value for key in hashtable. Value and key will be converted to string.
</p>
        </div>
      </div>

      <div id="method-M000014" class="method-detail">
        <a name="M000014"></a>

        <div class="method-heading">
          <a href="LocalMemCache.src/M000014.html" target="Code" class="method-signature"
            onclick="popupCode('LocalMemCache.src/M000014.html');return false;">
          <span class="method-name">lmc.size &rarr; number<br />
</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Number of pairs in the hashtable.
</p>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>